<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mecânico - Santa Terezinha</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --bg-color: #f1f2f6;
            --text-dark: #2d3436;
            --text-gray: #636e72;
            --white: #ffffff;
            --danger: #ff7675;
            --success: #00b894;
            --warning: #fdcb6e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body { background-color: var(--bg-color); color: var(--text-dark); padding: 20px; }

        /* HEADER */
        header { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        header h1 { font-size: 24px; color: var(--text-dark); }
        header p { color: var(--text-gray); font-size: 14px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; }
        .logout-btn { background: var(--danger); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* KPI CARDS */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            border-top: 4px solid var(--primary);
        }

        .kpi-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .kpi-title { font-size: 12px; font-weight: bold; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1px; }
        .kpi-icon { 
            background: var(--primary); 
            color: white; 
            width: 40px; height: 40px; 
            border-radius: 10px; 
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
        }
        
        .kpi-number { font-size: 36px; font-weight: bold; color: var(--text-dark); margin-bottom: 5px; }
        .kpi-sub { font-size: 12px; color: var(--text-gray); }

        /* NAVBAR */
        .nav-tabs {
            background: var(--white);
            padding: 0 20px;
            border-radius: 30px;
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            overflow-x: auto;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 20px 15px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-gray);
            cursor: pointer;
            position: relative;
            transition: 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover { color: var(--primary); }
        
        .tab-btn.active { color: var(--primary); }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .tab-btn i { margin-right: 8px; }

        /* CONTEÚDO DAS ABAS */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* BOTÕES E FORMULÁRIOS */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-action {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3);
            transition: 0.2s;
        }
        .btn-action:hover { background: #5649c0; transform: translateY(-2px); }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; color: var(--text-dark); }
        .form-control {
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;
            background: var(--white);
        }

        .btn { padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; border: none; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        /* CARDS */
        .card {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; }
        .st-active { background: #dff9fb; color: var(--success); }
        .st-inactive { background: #ffeaa7; color: #fdcb6e; }
        .st-danger { background: #ff7675; color: white; }
        .st-warning { background: #ffeaa7; color: #fdcb6e; }

        /* MODAL */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px;
            animation: popIn 0.3s; max-height: 90vh; overflow-y: auto;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .loading { text-align: center; padding: 40px; color: var(--text-gray); }
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-gray); }
        .empty-state i { font-size: 48px; margin-bottom: 15px; opacity: 0.5; }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>Painel do Mecânico</h1>
            <p>Gerencie chamados de manutenção e resolva problemas</p>
        </div>
        <div class="user-info">
            <div class="user-avatar" id="userAvatar" onclick="abrirModalPerfil()">M</div>
            <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
        </div>
    </header>

    <div class="kpi-container">
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-title">Chamados Abertos</span>
                <div class="kpi-icon"><i class="fas fa-tools"></i></div>
            </div>
            <div class="kpi-number" id="chamadosAbertos">0</div>
            <div class="kpi-sub">Aguardando atendimento</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-title">Em Andamento</span>
                <div class="kpi-icon"><i class="fas fa-wrench"></i></div>
            </div>
            <div class="kpi-number" id="chamadosAndamento">0</div>
            <div class="kpi-sub">Sendo resolvidos</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-title">Resolvidos Hoje</span>
                <div class="kpi-icon"><i class="fas fa-check-circle"></i></div>
            </div>
            <div class="kpi-number" id="chamadosResolvidos">0</div>
            <div class="kpi-sub">Concluídos com sucesso</div>
        </div>
    </div>

    <nav class="nav-tabs">
        <button class="tab-btn active" onclick="openTab(event, 'chamados')"><i class="fas fa-tools"></i> Chamados</button>
    </nav>
    
    <div id="chamados" class="tab-content active">
        <div class="section-header">
            <h3>Painel de Chamados</h3>
        </div>
        
        <div id="chamadosList">
            <div class="loading"><i class="fas fa-spinner fa-spin"></i> Carregando chamados...</div>
        </div>
    </div>

    <!-- Modal de Perfil -->
    <div id="modalPerfil" class="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="font-size: 1.5rem; font-weight: 700; color: #1f2937; margin: 0;">Perfil do Mecânico</h2>
                <button onclick="fecharModalPerfil()" style="background: none; border: none; font-size: 1.5rem; color: #6b7280; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: all 0.3s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2rem; color: white; font-weight: 700;" id="modalAvatar">
                    PO
                </div>
                <h3 style="font-size: 1.25rem; font-weight: 600; color: #1f2937; margin: 0;" id="modalNome">Pedro Oliveira</h3>
                <p style="color: #6b7280; margin: 0.5rem 0 0 0;" id="modalCargo">Mecânico</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div style="padding: 1rem; background: #f8fafc; border-radius: 12px;">
                    <p style="font-size: 0.875rem; color: #6b7280; margin: 0 0 0.5rem 0; font-weight: 500;">CPF</p>
                    <p style="font-size: 1rem; color: #1f2937; margin: 0; font-weight: 600;" id="modalCpf">123.456.789-00</p>
                </div>
                
                <div style="padding: 1rem; background: #f8fafc; border-radius: 12px;">
                    <p style="font-size: 0.875rem; color: #6b7280; margin: 0 0 0.5rem 0; font-weight: 500;">TELEFONE</p>
                    <p style="font-size: 1rem; color: #1f2937; margin: 0; font-weight: 600;">(49) 99999-8888</p>
                </div>
            </div>
            
            <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb; text-align: center;">
                <button onclick="fecharModalPerfil()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.75rem 2rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-check" style="margin-right: 8px;"></i>Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Resolver Chamado -->
    <div id="modalResolver" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Resolver Chamado</h3>
                <span class="close" onclick="fecharModalResolver()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formResolver">
                    <div class="form-group">
                        <label for="solucaoDescricao">Descrição da Solução *</label>
                        <textarea id="solucaoDescricao" class="form-control" rows="4" placeholder="Descreva o que foi feito para resolver o problema..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="solucaoPecas">Peças Utilizadas</label>
                        <textarea id="solucaoPecas" class="form-control" rows="3" placeholder="Liste as peças que foram trocadas ou utilizadas..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="solucaoCusto">Custo Estimado</label>
                        <input type="number" id="solucaoCusto" class="form-control" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="solucaoObservacoes">Observações Adicionais</label>
                        <textarea id="solucaoObservacoes" class="form-control" rows="3" placeholder="Outras observações importantes..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="fecharModalResolver()">Cancelar</button>
                <button class="btn btn-primary" onclick="confirmarResolucao()">
                    <i class="fas fa-check"></i> Confirmar Resolução
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: #6b7280; color: white; padding: 2rem 0 1rem; margin-top: 3rem;">
        <div class="container">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 1.5rem;">
                <div>
                    <h3 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.8rem; color: white;">Sistema Santa Terezinha</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">Sistema de gestão de transporte público</li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">Fraiburgo/SC</li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">Transporte urbano</li>
                    </ul>
                </div>
                <div>
                    <h3 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.8rem; color: white;">Contato</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">contato@santaterezinha.com</li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">(49) 99999-9999</li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">WhatsApp: (49) 99999-8888</li>
                    </ul>
                </div>
                <div>
                    <h3 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.8rem; color: white;">Funcionalidades</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">
                            <a href="#" onclick="openTab('chamados')" style="color: white; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#ffd700'" onmouseout="this.style.color='white'">
                                Gestão de Chamados
                            </a>
                        </li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">
                            <a href="#" onclick="openTab('manutencao')" style="color: white; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#ffd700'" onmouseout="this.style.color='white'">
                                Manutenção Preventiva
                            </a>
                        </li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">
                            <a href="#" onclick="openTab('frota')" style="color: white; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#ffd700'" onmouseout="this.style.color='white'">
                                Status da Frota
                            </a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.8rem; color: white;">Redes Sociais</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">
                            <a href="#" style="color: white; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#ffd700'" onmouseout="this.style.color='white'">
                                Facebook
                            </a>
                        </li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">
                            <a href="#" style="color: white; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#ffd700'" onmouseout="this.style.color='white'">
                                Instagram
                            </a>
                        </li>
                        <li style="margin-bottom: 0.4rem; font-size: 0.9rem;">
                            <a href="#" style="color: white; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#ffd700'" onmouseout="this.style.color='white'">
                                Twitter
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div style="border-top: 1px solid rgba(255, 255, 255, 0.3); padding-top: 1rem; text-align: center;">
                <p style="color: white; font-size: 0.9rem; margin: 0; font-weight: 500;">
                    Sistema Santa Terezinha - Fraiburgo/SC<br>
                    Rua das Flores, 123 - Centro - CEP: 89580-000<br>
                    Telefone: (49) 99999-9999 | Email: contato@santaterezinha.com
                </p>
                <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.8rem; margin: 0.5rem 0 0 0;">
                    &copy; 2024 Sistema Santa Terezinha. Desenvolvido para melhorar sua experiência no transporte público.
                </p>
            </div>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        // Estado da aplicação
        // usuarioAtual e chamadoAtual já estão declarados globalmente em app.js

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se usuário está logado
            const usuario = localStorage.getItem('usuarioAtual');
            if (!usuario) {
                window.location.href = 'login.html';
                return;
            }

            // usuarioAtual já está declarado globalmente em app.js
            usuarioAtual = JSON.parse(usuario);
            document.getElementById('userAvatar').textContent = usuarioAtual.nome.charAt(0);
            
            // Carregar dados iniciais
            loadDashboard();
            loadChamados();
        });

        // Função para abrir tabs
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }

            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }

            document.getElementById(tabName).style.display = "block";
            setTimeout(() => {
                document.getElementById(tabName).classList.add("active");
            }, 10);
            
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add("active");
            }
            
            // Carregar dados específicos
            switch(tabName) {
                case 'chamados':
                    loadChamados();
                    break;
            }
        }

        // Carregar dashboard
        async function loadDashboard() {
            try {
                const chamados = await carregarChamados();
                const abertos = chamados ? chamados.filter(c => c.status === 'aberto').length : 0;
                const emAndamento = chamados ? chamados.filter(c => c.status === 'em_andamento').length : 0;
                const resolvidos = chamados ? chamados.filter(c => c.status === 'resolvido').length : 0;
                
                document.getElementById('chamadosAbertos').textContent = abertos;
                document.getElementById('chamadosAndamento').textContent = emAndamento;
                document.getElementById('chamadosResolvidos').textContent = resolvidos;
                
                // Atualizar descrições baseadas nos dados reais
                const kpiCards = document.querySelectorAll('.kpi-card');
                if (kpiCards.length >= 3) {
                    kpiCards[0].querySelector('.kpi-sub').textContent = 
                        abertos === 0 ? 'Nenhum chamado aguardando' : `${abertos} aguardando atendimento`;
                    kpiCards[1].querySelector('.kpi-sub').textContent = 
                        emAndamento === 0 ? 'Nenhum em andamento' : `${emAndamento} sendo resolvidos`;
                    kpiCards[2].querySelector('.kpi-sub').textContent = 
                        resolvidos === 0 ? 'Nenhum resolvido hoje' : `${resolvidos} concluídos com sucesso`;
                }
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        // Carregar chamados
        async function loadChamados() {
            const container = document.getElementById('chamadosList');
            if (!container) return;
            
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Carregando chamados...</div>';
            
            try {
                const chamados = await carregarChamados();
                container.innerHTML = '';
                
                if (!chamados || chamados.length === 0) {
                    container.innerHTML = '<div class="empty-state"><i class="fas fa-tools"></i><p>Nenhum chamado encontrado.</p></div>';
                    return;
                }
            
            chamados.forEach(chamado => {
                const chamadoCard = document.createElement('div');
                chamadoCard.className = 'card';
                chamadoCard.style.marginBottom = '20px';
                
                let solucaoHtml = '';
                if (chamado.solucao) {
                    solucaoHtml = `
                        <div class="solucao">
                            <h4><i class="fas fa-check-circle"></i> Solução Aplicada</h4>
                            <p><strong>Descrição:</strong> ${chamado.solucao.descricao}</p>
                            ${chamado.solucao.pecas ? `<p><strong>Peças:</strong> ${chamado.solucao.pecas}</p>` : ''}
                            ${chamado.solucao.custo ? `<p><strong>Custo:</strong> R$ ${chamado.solucao.custo}</p>` : ''}
                            ${chamado.solucao.observacoes ? `<p><strong>Observações:</strong> ${chamado.solucao.observacoes}</p>` : ''}
                            <p style="font-size: 0.8rem; color: var(--gray); margin-top: 10px;">
                                <i class="fas fa-clock"></i> ${formatarData(chamado.solucao.data)}
                            </p>
                        </div>
                    `;
                }
                
                chamadoCard.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-title">Chamado #${chamado.id}</h3>
                        <span class="status-badge ${chamado.status === 'aberto' ? 'danger' : chamado.status === 'em_andamento' ? 'warning' : 'success'}">${chamado.status.toUpperCase()}</span>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                            <div style="padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 5px; font-weight: 500;">MOTORISTA</p>
                                <p style="font-weight: 600; color: #1f2937; font-size: 1.1rem;">${chamado.motorista_nome || chamado.motorista || 'N/A'}</p>
                            </div>
                            <div style="padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid #10b981;">
                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 5px; font-weight: 500;">VEÍCULO</p>
                                <p style="font-weight: 600; color: #1f2937; font-size: 1.1rem;">${chamado.veiculo_numero || chamado.veiculo || 'N/A'}</p>
                            </div>
                            <div style="padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 5px; font-weight: 500;">TIPO</p>
                                <p style="font-weight: 600; color: #1f2937; font-size: 1.1rem;">${chamado.tipo}</p>
                            </div>
                            <div style="padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 5px; font-weight: 500;">URGÊNCIA</p>
                                <span class="status-badge ${chamado.urgencia === 'alta' ? 'danger' : chamado.urgencia === 'media' ? 'warning' : 'success'}">${chamado.urgencia.toUpperCase()}</span>
                            </div>
                        </div>
                        
                        <div style="margin: 20px 0; padding: 20px; background: #f1f5f9; border-radius: 12px;">
                            <p style="font-size: 1rem; color: #374151; margin-bottom: 10px; font-weight: 600;">
                                <i class="fas fa-clipboard-list" style="margin-right: 8px; color: #3b82f6;"></i>Descrição do Problema
                            </p>
                            <p style="color: #6b7280; line-height: 1.6; font-size: 1rem;">${chamado.descricao}</p>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0; padding: 15px; background: #f8fafc; border-radius: 10px;">
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <span style="font-size: 0.875rem; color: #6b7280;">
                                    <i class="fas fa-clock"></i> ${formatarData(chamado.data)}
                                </span>
                                ${chamado.mecanico ? `<span style="font-size: 0.875rem; color: #6b7280;"><i class="fas fa-user-cog"></i> Mecânico: ${chamado.mecanico}</span>` : ''}
                            </div>
                            <div style="display: flex; gap: 10px;">
                                ${chamado.status === 'aberto' ? 
                                    `<button class="btn btn-warning btn-sm" onclick="assumirChamado(${chamado.id})">
                                        <i class="fas fa-tools"></i> Assumir Chamado
                                    </button>` : ''
                                }
                                ${chamado.status === 'em_andamento' ? 
                                    `<button class="btn btn-primary btn-sm" onclick="abrirModalResolver(${chamado.id})">
                                        <i class="fas fa-check"></i> Resolver Chamado
                                    </button>` : ''
                                }
                            </div>
                        </div>
                        
                        ${solucaoHtml}
                        
                        ${chamado.status === 'em_andamento' ? `
                            <div style="margin-top: 20px; padding: 20px; background: #fef3c7; border-radius: 12px; border: 1px solid #f59e0b;">
                                <h4 style="margin-bottom: 15px; color: #92400e; display: flex; align-items: center;">
                                    <i class="fas fa-wrench" style="margin-right: 8px;"></i>
                                    Resolução do Chamado
                                </h4>
                                <form id="formResolverInline${chamado.id}" onsubmit="resolverChamadoInline(${chamado.id}, event)">
                                    <div class="form-group">
                                        <label for="solucaoDescricao${chamado.id}">Descrição da Solução *</label>
                                        <textarea id="solucaoDescricao${chamado.id}" class="form-control" rows="3" placeholder="Descreva o que foi feito para resolver o problema..." required></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="solucaoPecas${chamado.id}">Peças Utilizadas</label>
                                        <textarea id="solucaoPecas${chamado.id}" class="form-control" rows="2" placeholder="Liste as peças que foram trocadas ou utilizadas..."></textarea>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div class="form-group">
                                            <label for="solucaoCusto${chamado.id}">Custo Estimado (R$)</label>
                                            <input type="number" id="solucaoCusto${chamado.id}" class="form-control" step="0.01" placeholder="0.00">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="urgenciaConfirmada${chamado.id}">Confirmar Urgência</label>
                                            <select id="urgenciaConfirmada${chamado.id}" class="form-control">
                                                <option value="${chamado.urgencia}">${chamado.urgencia.toUpperCase()}</option>
                                                <option value="baixa">BAIXA</option>
                                                <option value="media">MÉDIA</option>
                                                <option value="alta">ALTA</option>
                                                <option value="critica">CRÍTICA</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="solucaoObservacoes${chamado.id}">Observações Adicionais</label>
                                        <textarea id="solucaoObservacoes${chamado.id}" class="form-control" rows="2" placeholder="Outras observações importantes..."></textarea>
                                    </div>
                                    
                                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-check"></i> Confirmar Resolução
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="cancelarResolucaoInline(${chamado.id})">
                                            <i class="fas fa-times"></i> Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(chamadoCard);
            });
            } catch (error) {
                console.error('Erro ao carregar chamados:', error);
                container.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Erro ao carregar chamados.</p></div>';
            }
        }

        // Assumir chamado
        async function assumirChamado(id) {
            try {
                await atualizarChamadoAPI(id, { status: 'em_andamento', mecanico_id: usuarioAtual.id });
                await loadChamados();
                await loadDashboard();
                showNotification('Chamado assumido com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao assumir chamado:', error);
                showNotification('Erro ao assumir chamado.', 'error');
            }
        }

        // Resolver chamado inline
        async function resolverChamadoInline(id, event) {
            event.preventDefault();
            
            const descricao = document.getElementById(`solucaoDescricao${id}`).value;
            const pecas = document.getElementById(`solucaoPecas${id}`).value;
            const custo = document.getElementById(`solucaoCusto${id}`).value;
            const observacoes = document.getElementById(`solucaoObservacoes${id}`).value;
            const urgenciaConfirmada = document.getElementById(`urgenciaConfirmada${id}`).value;
            
            if (!descricao) {
                showNotification('A descrição da solução é obrigatória.', 'error');
                return;
            }
            
            try {
                // Atualizar chamado via API
                await atualizarChamadoAPI(id, {
                    status: 'resolvido',
                    mecanico_id: usuarioAtual.id,
                    solucao_descricao: descricao,
                    solucao_pecas: pecas,
                    solucao_custo: custo,
                    solucao_observacoes: observacoes,
                    urgencia: urgenciaConfirmada
                });
                
                await loadChamados();
                await loadDashboard();
                showNotification('Chamado resolvido com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao resolver chamado:', error);
                showNotification('Erro ao resolver chamado.', 'error');
            }
        }

        // Cancelar resolução inline
        function cancelarResolucaoInline(id) {
            const form = document.getElementById(`formResolverInline${id}`);
            form.reset();
        }

        // Abrir modal de resolução
        function abrirModalResolver(id) {
            chamadoAtual = id;
            document.getElementById('modalResolver').style.display = 'block';
        }

        // Fechar modal de resolução
        function fecharModalResolver() {
            chamadoAtual = null;
            document.getElementById('modalResolver').style.display = 'none';
            document.getElementById('formResolver').reset();
        }

        // Confirmar resolução
        async function confirmarResolucao() {
            const descricao = document.getElementById('solucaoDescricao').value;
            const pecas = document.getElementById('solucaoPecas').value;
            const custo = document.getElementById('solucaoCusto').value;
            const observacoes = document.getElementById('solucaoObservacoes').value;
            
            if (!descricao) {
                showNotification('A descrição da solução é obrigatória.', 'error');
                return;
            }
            
            try {
                // Atualizar chamado via API
                await atualizarChamadoAPI(chamadoAtual, {
                    status: 'resolvido',
                    mecanico_id: usuarioAtual.id,
                    solucao_descricao: descricao,
                    solucao_pecas: pecas,
                    solucao_custo: custo,
                    solucao_observacoes: observacoes
                });
                
                await loadChamados();
                await loadDashboard();
                fecharModalResolver();
                showNotification('Chamado resolvido com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao resolver chamado:', error);
                showNotification('Erro ao resolver chamado.', 'error');
            }
        }

        // Fechar modal ao clicar fora
        document.getElementById('modalResolver').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalResolver();
            }
        });

        // Funções utilitárias
        function formatarData(dataString) {
            const data = new Date(dataString);
            return data.toLocaleString('pt-BR');
        }

        function logout() {
            localStorage.removeItem('usuarioAtual');
            window.location.href = 'login.html';
        }

        // Modal de Perfil
        function abrirModalPerfil() {
            document.getElementById('modalPerfil').style.display = 'block';
        }

        function fecharModalPerfil() {
            document.getElementById('modalPerfil').style.display = 'none';
        }

        // Fechar modal ao clicar fora
        document.getElementById('modalPerfil').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalPerfil();
            }
        });

        function showNotification(message, type = 'info') {
            // Criar elemento de notificação
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                padding: 15px 20px;
                border-radius: 6px;
                color: white;
                font-weight: 500;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--primary)'};
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remover após 3 segundos
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>